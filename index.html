

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>IBM Quantum Jobs Dashboard (Local)</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
<style>
  @keyframes pulse-quantum {0%,100%{opacity:1}50%{opacity:0.5}}
  .quantum-pulse{animation:pulse-quantum 2s infinite;}
  @keyframes spin-slow{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
  .spin-slow{animation:spin-slow 3s linear infinite;}
  .details-row {transition: all 0.3s ease;}
  .highlight-match {
    background: linear-gradient(90deg, rgba(34, 197, 94, 0.3), rgba(34, 197, 94, 0.1));
    border: 1px solid rgba(34, 197, 94, 0.5);
    border-radius: 4px;
  }
</style>
</head>
<body class="bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 min-h-screen text-white">
<div class="container mx-auto px-6 py-8">

  <!-- Header -->
  <div class="text-center mb-8">
    <h1 class="text-4xl font-bold mb-2 bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent">
      Quantum Jobs Dashboard (Local Simulator)
    </h1>
    <p class="text-gray-300 text-lg">Simulated quantum jobs (no paid account required)</p>
    <div class="mt-4 flex justify-center items-center space-x-4">
      <div class="flex items-center space-x-2">
        <div class="w-3 h-3 bg-green-400 rounded-full quantum-pulse"></div>
        <span class="text-sm text-gray-300">Live Updates</span>
      </div>
      <div class="text-sm text-gray-400">Last updated: <span id="lastUpdate">--:--:--</span></div>
    </div>
  </div>

  <!-- Stats + New Job form -->
  <div class="grid grid-cols-1 md:grid-cols-5 gap-6 mb-8">
    <div class="md:col-span-3 bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-gray-300 text-sm">Total Jobs</p>
          <p class="text-2xl font-bold text-white" id="totalJobs">0</p>
        </div>
        <div>
          <p class="text-gray-300 text-sm">Running</p>
          <p class="text-2xl font-bold text-green-400" id="runningJobs">0</p>
        </div>
        <div>
          <p class="text-gray-300 text-sm">Queued</p>
          <p class="text-2xl font-bold text-yellow-400" id="queuedJobs">0</p>
        </div>
        <div>
          <p class="text-gray-300 text-sm">Completed</p>
          <p class="text-2xl font-bold text-purple-400" id="completedJobs">0</p>
        </div>
      </div>
    </div>

    <!-- New Job inline form -->
    <div class="md:col-span-2 bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
      <h3 class="text-white font-semibold mb-3">Create New Job</h3>
      <div class="flex flex-wrap gap-2 items-center">
        <select id="newBackend" class="bg-white/10 text-white rounded px-2 py-1">
          <option>Loading...</option>
        </select>
        <input id="newQubits" class="bg-white/10 text-white rounded px-2 py-1 w-20" type="number" min="1" value="2" />
        <input id="newShots" class="bg-white/10 text-white rounded px-2 py-1 w-28" type="number" min="1" value="1024" />
        <button id="createJobBtn" class="px-3 py-1 bg-gradient-to-r from-purple-500 to-pink-500 rounded">Create</button>
      </div>
      <p class="text-xs text-gray-300 mt-3">Pick backend, qubits, shots then click <strong>Create</strong>.</p>
    </div>
  </div>

  <!-- Filters -->
  <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20 mb-8 flex flex-wrap gap-4 items-center">
    <div class="flex items-center space-x-2">
      <label class="text-sm text-gray-300">Search Job ID:</label>
      <input id="searchFilter" class="bg-white/20 border border-white/30 rounded-lg px-3 py-2 text-white text-sm placeholder-gray-400" 
             type="text" placeholder="Enter Job ID..." />
      <button id="clearSearchBtn" class="px-2 py-1 text-xs bg-gray-500/30 rounded hover:bg-gray-500/50 transition-colors">Clear</button>
    </div>
    <div class="flex items-center space-x-2">
      <label class="text-sm text-gray-300">Status:</label>
      <select id="statusFilter" class="bg-white/20 border border-white/30 rounded-lg px-3 py-2 text-black text-sm">
        <option value="all">All</option>
        <option value="running">Running</option>
        <option value="queued">Queued</option>
        <option value="completed">Completed</option>
        <option value="error">Error</option>
      </select>
    </div>
    <div class="flex items-center space-x-2">
      <label class="text-sm text-gray-300">Backend:</label>
      <select id="backendFilter" class="bg-white/20 border border-white/30 rounded-lg px-3 py-2 text-black text-sm">
        <option value="all">All Backends</option>
      </select>
    </div>
    <button id="refreshBtn" class="ml-auto bg-gradient-to-r from-purple-500 to-pink-500 px-4 py-2 rounded-lg text-sm">Refresh Data</button>
  </div>

  <!-- Jobs Table -->
  <div class="bg-white/10 backdrop-blur-lg rounded-xl border border-white/20 overflow-hidden">
    <div class="p-6 border-b border-white/20">
      <h2 class="text-xl font-semibold text-white">Active Quantum Jobs</h2>
      <div id="searchResults" class="mt-2 text-sm text-gray-300" style="display: none;"></div>
    </div>
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead class="bg-white/5">
          <tr>
            <th class="px-6 py-4 text-left text-sm text-gray-300">Job ID</th>
            <th class="px-6 py-4 text-left text-sm text-gray-300">Status</th>
            <th class="px-6 py-4 text-left text-sm text-gray-300">Backend</th>
            <th class="px-6 py-4 text-left text-sm text-gray-300">Qubits</th>
            <th class="px-6 py-4 text-left text-sm text-gray-300">Shots</th>
            <th class="px-6 py-4 text-left text-sm text-gray-300">Queue Position</th>
            <th class="px-6 py-4 text-left text-sm text-gray-300">Created</th>
            <th class="px-6 py-4 text-left text-sm text-gray-300">Duration</th>
            <th class="px-6 py-4 text-left text-sm text-gray-300">Actions</th>
          </tr>
        </thead>
        <tbody id="jobsTableBody" class="divide-y divide-white/10"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quantum Jobs Dashboard</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col">

  <!-- HEADER -->
  <header class="bg-gray-800 p-4 shadow-lg flex justify-between items-center">
    <h1 class="text-2xl font-bold text-blue-400">Quantum Jobs Dashboard</h1>
    <nav>
      <button id="createJobBtn" class="bg-blue-500 px-4 py-2 rounded hover:bg-blue-600">+ New Job</button>
    </nav>
  </header>

  <!-- MAIN -->
  <main class="flex-1 p-6">
    <section class="mb-6">
      <h2 class="text-xl font-semibold mb-4">Available Backends</h2>
      <div id="backendList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </section>

    <section>
      <h2 class="text-xl font-semibold mb-4">Job Queue</h2>
      <div id="jobsTable" class="overflow-x-auto">
        <table class="min-w-full border border-gray-700 text-sm">
          <thead class="bg-gray-700">
            <tr>
              <th class="px-3 py-2 border border-gray-600">Job ID</th>
              <th class="px-3 py-2 border border-gray-600">Backend</th>
              <th class="px-3 py-2 border border-gray-600">Status</th>
              <th class="px-3 py-2 border border-gray-600">Submitted</th>
              <th class="px-3 py-2 border border-gray-600">Duration</th>
              <th class="px-3 py-2 border border-gray-600">Actions</th>
            </tr>
          </thead>
          <tbody id="jobsBody" class="divide-y divide-gray-700"></tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="bg-gray-800 p-4 text-center text-gray-400 text-sm">
    Quantum Dashboard &copy; 2025
  </footer>

  <script>
    const apiBase = "https://quantum-hackathon-2.onrender.com";

    // ---------- helpers ----------
    async function fetchJobs(){ return (await fetch(`${apiBase}/jobs`)).json(); }
    async function fetchBackends(){ return (await fetch(`${apiBase}/backends`)).json(); }
    async function fetchJob(id){ return (await fetch(`${apiBase}/jobs/${id}`)).json(); }

    function formatTimeAgo(dateStr){
      if(!dateStr) return '--';
      const date = new Date(dateStr);
      const diff = Date.now() - date;
      const mins = Math.floor(diff/60000);
      const hrs = Math.floor(mins/60);
      const days = Math.floor(hrs/24);
      if(days>0) return `${days}d ago`;
      if(hrs>0) return `${hrs}h ago`;
      if(mins>0) return `${mins}m ago`;
      return 'Just now';
    }

    function formatDuration(duration){
      if(duration === null || duration === undefined) return '--';
      const secs = typeof duration === 'number' ? duration : parseFloat(duration) || 0;
      if(secs < 1) return `${Math.round(secs*1000)}ms`;
      const m = Math.floor(secs/60);
      const s = (secs % 60).toFixed(2);
      return m > 0 ? `${m}m ${s}s` : `${s}s`;
    }

    // ---------- create job ----------
    document.getElementById('createJobBtn').addEventListener('click', async ()=>{
      const backend = prompt("Enter backend name:");
      const qubits = parseInt(prompt("Enter qubit count:")) || 2;
      const shots = parseInt(prompt("Enter shots:")) || 1024;
      const res = await fetch(`${apiBase}/jobs/new`, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({backend, qubits, shots})
      });
      if(res.status === 201){
        renderJobs();
      } else {
        const err = await res.json();
        alert("Error creating job: " + (err.error || JSON.stringify(err)));
      }
    });

    // ---------- run job ----------
    async function runJob(jobId, btnEl){
      try {
        if(btnEl) { btnEl.disabled = true; btnEl.textContent = 'Running...'; }
        const res = await fetch(`${apiBase}/jobs/run/${jobId}`, { method: "POST" });
        const data = await res.json();
        if(res.status !== 200){
          alert("Run error: " + (data.error || JSON.stringify(data)));
          if(btnEl) { btnEl.disabled = false; btnEl.textContent = 'Run'; }
          renderJobs();
          return;
        }
        const histogramId = `hist_${jobId}`;
        const tableId = `table_${jobId}`;
        const histogramDiv = document.getElementById(histogramId);
        const tableEl = document.getElementById(tableId);
        if(histogramDiv && data.result){
          const keys = Object.keys(data.result);
          const vals = Object.values(data.result);
          Plotly.newPlot(histogramDiv, [{x:keys,y:vals,type:'bar'}], {title:'Measurement Results'});
        }
        if(tableEl && data.result){
          tableEl.innerHTML = "";
          Object.entries(data.result).forEach(([k,v])=>{
            const row = document.createElement('tr');
            const intensity = Math.min(255, Math.round(v*10));
            row.innerHTML = `<td class="px-2 py-1 border border-white/20">${k}</td>
                             <td class="px-2 py-1 border border-white/20">${v}</td>`;
            row.children[1].style.backgroundColor = `rgb(${255-intensity},${255-intensity},255)`;
            tableEl.appendChild(row);
          });
        }
        renderJobs();
      } catch(err){
        console.error(err);
        alert("Run failed: "+err);
      }
    }

    // ---------- render ----------
    async function renderBackends(){
      const backends = await fetchBackends();
      const div = document.getElementById('backendList');
      div.innerHTML = "";
      backends.forEach(b=>{
        const card = document.createElement('div');
        card.className = "bg-gray-700 p-4 rounded shadow";
        card.innerHTML = `<h3 class="font-semibold text-blue-300">${b.name}</h3>
                          <p>Status: ${b.status}</p>
                          <p>Qubits: ${b.qubits}</p>`;
        div.appendChild(card);
      });
    }

    async function renderJobs(){
      const jobs = await fetchJobs();
      const body = document.getElementById('jobsBody');
      body.innerHTML = "";
      jobs.forEach(job=>{
        const tr = document.createElement('tr');
        tr.id = `row_${job['Job ID']}`;
        tr.className = "hover:bg-gray-800";
        tr.innerHTML = `
          <td class="px-3 py-2 border border-gray-700">${job['Job ID']}</td>
          <td class="px-3 py-2 border border-gray-700">${job['Backend']}</td>
          <td class="px-3 py-2 border border-gray-700">${job['Status']}</td>
          <td class="px-3 py-2 border border-gray-700">${formatTimeAgo(job['Submission Time'])}</td>
          <td class="px-3 py-2 border border-gray-700">${formatDuration(job['Execution Duration (s)'])}</td>
          <td class="px-3 py-2 border border-gray-700">
            <button id="run_${job['Job ID']}" class="bg-green-500 px-2 py-1 rounded text-sm">Run</button>
            <button id="view_${job['Job ID']}" class="bg-gray-500 px-2 py-1 rounded text-sm">View</button>
          </td>`;
        body.appendChild(tr);

        document.getElementById(`run_${job['Job ID']}`).onclick = (e)=> runJob(job['Job ID'], e.target);
        document.getElementById(`view_${job['Job ID']}`).onclick = async ()=>{
          const detailsRow = document.getElementById(`details_${job['Job ID']}`);
          if(detailsRow){
            detailsRow.remove();
          } else {
            const dtr = document.createElement('tr');
            dtr.id = `details_${job['Job ID']}`;
            dtr.innerHTML = `<td colspan="6" class="bg-gray-800 p-4">
              <div id="hist_${job['Job ID']}" class="h-64"></div>
              <table class="mt-2 text-sm border border-white/20">
                <thead><tr><th>Bitstring</th><th>Counts</th></tr></thead>
                <tbody id="table_${job['Job ID']}"></tbody>
              </table>
            </td>`;
            tr.after(dtr);
            const jobDetail = await fetchJob(job['Job ID']);
            if(jobDetail.result){
              const keys = Object.keys(jobDetail.result);
              const vals = Object.values(jobDetail.result);
              Plotly.newPlot(`hist_${job['Job ID']}`, [{x:keys,y:vals,type:'bar'}], {title:'Measurement Results'});
              const tableEl = document.getElementById(`table_${job['Job ID']}`);
              tableEl.innerHTML = "";
              Object.entries(jobDetail.result).forEach(([k,v])=>{
                const row = document.createElement('tr');
                const intensity = Math.min(255, Math.round(v*10));
                row.innerHTML = `<td class="px-2 py-1 border border-white/20">${k}</td>
                                 <td class="px-2 py-1 border border-white/20">${v}</td>`;
                row.children[1].style.backgroundColor = `rgb(${255-intensity},${255-intensity},255)`;
                tableEl.appendChild(row);
              });
            }
          }
        }
      });
    }

    // ---------- startup ----------
    renderBackends();
    renderJobs();
    setInterval(renderJobs, 10000);


</script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'975adde6d49e25c9',t:'MTc1NjI5MDM0Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
